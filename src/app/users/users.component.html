<grid-main [class]="'fmxw-500: w-500'" [centered]="true">
  <ul ngbNav #nav="ngbNav"  class="nav-tabs ">
    <li [ngbNavItem]="1">
      <button ngbNavLink (click)="OnTabChange(1)">Single</button>
      <ng-template ngbNavContent *ngIf="isActiveTab(1)">
        <form [formGroup]="singleTabForm" (ngSubmit)="onSubmit()" class="bg-white">
    <app-page-subtitle [subtitle]="'Create User'"></app-page-subtitle>
    <div class="row bg-transparent" >
      <grid-form-input [name]="'User Name'" [labelclass]="'requiredak'">
        <input
              type='text'
              id="name"
              class='form-control'
              formControlName="name"
        >
      </grid-form-input>
      <span *ngIf="singleTabForm.get('name').invalid && singleTabForm.get('name').touched" class="help-block">User already exist!</span>
      <grid-form-input [name]="'Email'" [labelclass]="'requiredak'">
        <input
                type='email'
                id="email"
                class='form-control'
                formControlName="email"
          >
      </grid-form-input>
      <grid-form-input [name]="'Access Permission Group'" [labelclass]="'requiredak'">
        <select
              type='number'
              id="globalPermissionGroupId"
              class='form-select'
              formControlName="globalPermissionGroupId"
              >
              <option *ngFor="let a of agp" [ngValue]="a.id">{{ a.name }}</option>
        </select>
      </grid-form-input>
     
      <button-submit [name]="'Create'"></button-submit>
    </div>
  </form>
      </ng-template>
    </li>


    <li [ngbNavItem]="2" >
      <button ngbNavLink (click)="OnTabChange(2)">Multiple</button>
  <ng-template ngbNavContent *ngIf="isActiveTab(2)">
    <form [formGroup]="multipleTabForm" (ngSubmit)="onSubmit()" class="bg-white" >
    <app-page-subtitle [subtitle]="'Create Multiple Users'"></app-page-subtitle>
    <p>Select your .csv file.</p>
    <button type="button" class="btn btn-secondary mb-2" (click)="importantCsvNote = !importantCsvNote">Example .csv table</button>
    <div *ngIf="importantCsvNote">
      The csv file must contain the following columns in the right order:
      name, email, group
      <table class="table table-striped table-sm mt-2"> 
        <thead class="thead-light">
        <tr>
          <th>name</th>
          <th>email</th>
          <th>group</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>John Doe</td>
          <td>johndoe@test.com</td>
          <td>Student</td>
        </tr>
        <tr>
          <td>Jane Doe</td>
          <td>janedoe@test.com</td>
          <td>Student</td>
        </tr>
        </tbody>
      </table>

    </div>
      <input
        type="file"
        accept=".csv"
        class="form-control fileuploadspan"
        formControlName="sourceData"
        (change)="onFileChange($event)"
        required
      >
    
    
    <div class="bg-white" *ngIf="showTable">
      <div class="d-flex flex-column">
      <div class="d-flex align-items-center m-1">
      <input type="checkbox"  
      [(ngModel)]="isIgnoreGroups" 
      [ngModelOptions]="{ standalone: true }" 
      (change)="ignoreGroups(isIgnoreGroups)"
      >
      <div class="ms-1">Ignore groups that do not exist in Hashtopolis</div>
    </div>
      <div *ngIf="isIgnoreGroups" class="alert alert-info" role="alert">
        <p> Define a group for all users in the list whose group does not exist in Hashtopolis or no group has been specified</p>
      <select [(ngModel)]="selectedAccessPermission" [ngModelOptions]="{ standalone: true }" name="accessPermission"
       (change)="assignToNotSpecifiedGroup()">
        <option *ngFor="let a of agp" [ngValue]="a">
          {{ a.name }}
        </option>
      </select>
     
      </div>
      <div class="alert alert-danger" role="alert" *ngIf="errorInGroups">
        At least one Permission Group is wrong or does not exist in Hashtopolis
      </div>
      <div class="alert alert-danger" role="alert" *ngIf="nameUsed">
        At least one User Name is already used
      </div>
    </div>
      <table *ngIf="showTable" class="table table-striped table-sm mt-2">
        <thead class="thead-light">
          <tr>
            <th class="rounded-start">User Name</th>
            <th>Email</th>
            <th class="rounded-end">Access Permission Group</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of userData; let i = index">
            <td>
              <span [style.color]="hasErrorInName(user) ? 'red' : 'green'">
              {{ user.name }}
            </span>
            </td>
              
            <td>{{ user.email }}</td>
            <td>
              <ng-container >
                <span [style.color]="hasErrorInGroup(user) ? 'red' : 'green'">{{ user.group }}</span>
               
              </ng-container>
             <!--  <ng-template #editMode>
                <select [(ngModel)]="user.globalPermissionGroupId" (change)="stopEditing(i)">
                  <option value="Studenten_SS23">Studenten_SS23</option>
                  <option *ngFor="let a of agp" [ngValue]="a.id">
                    {{ a.name }}
                  </option>
                </select>
              </ng-template> -->
            </td>
          </tr>
        </tbody>
      </table>
          <button-submit [name]="'Create'" class="d-flex mt-5"></button-submit>
        </div>
      </form>
  </ng-template>
</li>
  </ul>
  
<div [ngbNavOutlet]="nav" class="mt-2"></div>
</grid-main>

